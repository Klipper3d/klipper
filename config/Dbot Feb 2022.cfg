[include kiauh_macros.cfg]

[tmc2130 stepper_x]
cs_pin: PK3
spi_software_sclk_pin: PG1
spi_software_mosi_pin: PL7
spi_software_miso_pin: PL5
interpolate: True
run_current: 0.7
driver_PWM_GRAD: 10
sense_resistor: 0.110
stealthchop_threshold: 99999

[stepper_x]
step_pin: PF0
dir_pin: !PF1
enable_pin: !PD7
microsteps: 16
rotation_distance = 32
endstop_pin: ^!PE5
position_endstop: -16
position_min: -16
position_max: 310
homing_speed: 40

[tmc2130 stepper_y]
cs_pin: PK4
spi_software_sclk_pin: PG1
spi_software_mosi_pin: PL7
spi_software_miso_pin: PL5
interpolate: True
run_current: 0.7
driver_PWM_GRAD: 10
sense_resistor: 0.110
stealthchop_threshold: 99999

[stepper_y]
step_pin: PF6
dir_pin: !PF7
enable_pin: !PF2
microsteps: 16
rotation_distance = 32
endstop_pin: ^!PJ1
position_endstop: -25
position_min: -25
position_max: 280
homing_speed: 40

[stepper_z]
step_pin: PL3
dir_pin: !PL1
enable_pin: !PK0
microsteps: 16
rotation_distance = 8
endstop_pin: probe:z_virtual_endstop
#position_endstop: 0.480
position_max: 380
position_min: -2

[extruder]
step_pin: PA4
dir_pin: PA6
enable_pin: !PA2
microsteps: 16
rotation_distance = 8.2
nozzle_diameter: 0.400
filament_diameter: 1.750
pressure_advance: 0.03
max_extrude_only_distance: 200.0
heater_pin: PB4
sensor_type: ATC Semitec 104GT-2
sensor_pin: PK5
min_temp: 0
max_temp: 270

[heater_bed]
heater_pin: PH5
sensor_type: Generic 3950
sensor_pin: PK6
control: watermark
max_delta: 1.0
min_temp: 0
max_temp: 90

[fan]
pin: PH6

[virtual_sdcard]
path: ~/gcode_files

[mcu]
serial: /dev/serial/by-id/usb-Arduino__www.arduino.cc__0042_85735313433351203220-if00

[printer]
kinematics: corexy
max_velocity: 300
max_accel: 2000
max_accel_to_decel: 2000
#max_accel: 7000
#max_accel_to_decel: 7000
max_z_velocity: 25
max_z_accel: 30

[display]
lcd_type: hd44780
rs_pin: PH1
e_pin: PH0
d4_pin: PA1
d5_pin: PA3
d6_pin: PA5
d7_pin: PA7
encoder_pins: ^PC6, ^PC4
click_pin: ^!PC2

[menu __main __octoprint __pause]
type: command
enable: {printer.idle_timeout.state == "Printing"}
name: Pause printing
gcode:
    {% if "pause_resume" in printer %}
        PAUSE
    {% else %}
        {action_respond_info('action:pause')}
    {% endif %}

[menu __main __octoprint __resume]
type: command
enable: {not printer.idle_timeout.state == "Printing"}
name: Resume printing
gcode:
    {% if "pause_resume" in printer %}
        RESUME
    {% else %}
        {action_respond_info('action:resume')}
    {% endif %}

[menu __main __octoprint __abort]
type: command
enable: {printer.idle_timeout.state == "Printing"}
name: Abort printing
gcode:
    {% if 'pause_resume' in printer %}
        CANCEL_PRINT
    {% else %}
        {action_respond_info('action:cancel')}
    {% endif %}

[menu __main __filament __loadf]
type: command
name: Load Fil. fast
gcode:
    SAVE_GCODE_STATE NAME=__filament__load
    M83
    G1 E70 F960
    RESTORE_GCODE_STATE NAME=__filament__load

[menu __main __filament __loads]
type: command
name: Load Fil. slow
gcode:
    SAVE_GCODE_STATE NAME=__filament__load
    M83
    G1 E70 F240
    RESTORE_GCODE_STATE NAME=__filament__load

[menu __main __filament __unloadf]
type: command
name: Unload Fil.fast
gcode:
    SAVE_GCODE_STATE NAME=__filament__load
    M83
    G1 E-100 F960
    RESTORE_GCODE_STATE NAME=__filament__load

[menu __main __filament __unloads]
type: command
name: Unload Fil.slow
gcode:
    SAVE_GCODE_STATE NAME=__filament__load
    M83
    G1 E-100 F240
    RESTORE_GCODE_STATE NAME=__filament__load

[menu __main __filament __feed]
type: input
name: Feed: {'%.1f' % menu.input}
input: 5
input_step: 0.1
gcode:
    SAVE_GCODE_STATE NAME=__filament__load
    M83
    G1 E{'%.1f' % menu.input} F60
    RESTORE_GCODE_STATE NAME=__filament__load

[menu __main __filament __width_current]
type: command
enable: {'hall_filament_width_sensor' in printer}
name: Dia: {'%.2F' % printer.hall_filament_width_sensor.Diameter}
index: 0

[menu __main __filament __raw_width_current]
type: command
enable: {'hall_filament_width_sensor' in printer}
name: Raw: {'%4.0F' % printer.hall_filament_width_sensor.Raw}
index: 1

[idle_timeout]
timeout: 7200

[input_shaper]
shaper_freq_x: 36.4
shaper_freq_y: 38.8
shaper_type: mzv

[bltouch]
sensor_pin: ^PD3
control_pin: PB5
x_offset: -30.0
y_offset: 20.0

[safe_z_home]
home_xy_position: 160,130 # Change coordinates to the center of your print bed
speed: 20
z_hop: 10                 # Move up 10mm
z_hop_speed: 3

[bed_mesh]
horizontal_move_z: 5
mesh_min: 10, 0
mesh_max: 280, 280
probe_count: 3,3
fade_start: 1.0
mesh_pps: 2,2

[screws_tilt_adjust]
screw1: 40,20
screw1_name: front left screw
screw2: 290,20
screw2_name: front right screw
screw3: 290,260
screw3_name: rear right screw
screw4: 40,260
screw4_name: rear left screw
horizontal_move_z: 3
speed: 20
screw_thread: CCW-M3

#[filament_switch_sensor switchy]
#pause_on_runout: True
#pause_delay: 5.0
#switch_pin: ^!PD2

[hall_filament_width_sensor]
adc1:PF3
adc2:PF4
#   Analog input pins connected to the sensor. These parameters must
#   be provided.
cal_dia1: 1.16
cal_dia2: 1.98
#   The calibration values (in mm) for the sensors. The default is
#   1.50 for cal_dia1 and 2.00 for cal_dia2.
raw_dia1: 10170
raw_dia2: 11560
#   The raw calibration values for the sensors. The default is 9500
#   for raw_dia1 and 10500 for raw_dia2.
default_nominal_filament_diameter: 1.75
#   The nominal filament diameter. This parameter must be provided.
max_difference: 0.200
#   Maximum allowed filament diameter difference in millimeters (mm).
#   If difference between nominal filament diameter and sensor output
#   is more than +- max_difference, extrusion multiplier is set back
#   to %100. The default is 0.200.
measurement_delay: 850
#   The distance from sensor to the melting chamber/hot-end in
#   millimeters (mm). The filament between the sensor and the hot-end
#   will be treated as the default_nominal_filament_diameter. Host
#   module works with FIFO logic. It keeps each sensor value and
#   position in an array and POP them back in correct position. This
#   parameter must be provided.
enable: True
#   Sensor enabled or disabled after power on. The default is to
#   disable.
#measurement_interval: 10
#   The approximate distance (in mm) between sensor readings. The
#   default is 10mm.
#logging: False
#   Out diameter to terminal and klipper.log can be turn on|of by
#   command.
min_diameter: 1.0
#   Minimal diameter for trigger virtual filament_switch_sensor.
#use_current_dia_while_delay: False
#   Use the current diameter instead of the nominal diameter while
#   the measurement delay has not run through.
pause_on_runout: False
runout_gcode: F_CONSUMED
#insert_gcode:
event_delay: 3.0
#pause_delay:
#   See the "filament_switch_sensor" section for a description of the
#   above parameters.

[output_pin BEEPER_pin]
pin: PC0
#   Beeper pin. This parameter must be provided.
#   ar37 is the default RAMPS/MKS pin.
pwm: True
#   A piezo beeper needs a PWM signal, a DC buzzer doesn't.
value: 0
#   Silent at power on, set to 1 if active low.
shutdown_value: 0
#   Disable at emergency shutdown (no PWM would be available anyway).
cycle_time: 0.001
#   Default PWM frequency : 0.001 = 1ms will give a tone of 1kHz
#   Although not pitch perfect.

[mcu rpi]
serial: /tmp/klipper_host_mcu

[adxl345]
cs_pin: rpi:None

[resonance_tester]
accel_chip: adxl345
probe_points:
    140,140,20  # an example

[palette2]
serial: /dev/serial/by-id/usb-FTDI_FT230X_Basic_UART_DM00NU90-if00-port0
#   The serial port to connect to the Palette 2.
#baud: 115200
#   The baud rate to use. The default is 115200.
#feedrate_splice: 0.8
#   The feedrate to use when splicing, default is 0.8
#feedrate_normal: 1.0
#   The feedrate to use after splicing, default is 1.0
#auto_load_speed: 2
#   Extrude feedrate when autoloading, default is 2 (mm/s)
#auto_cancel_variation: 0.1
#   Auto cancel print when ping varation is above this threshold

#increasing the value o z_offset will make the nozzle closer to the bed
#reducing the value will make the nozzle further out

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [bltouch]
#*# z_offset = 1.095
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 31.909
#*# pid_ki = 1.729
#*# pid_kd = 147.181
