# To install Klipper on your Raspberry pi (octoprint) or PC (any debian flavor)
# try KIAUH https://github.com/th33xitus/kiauh#-download-and-use-kiauh


# This file contains common pin mappings for XYZPrint Crazy3DPrint CZ-300.
# To use this config, the firmware should be compiled for the SAM4S8C (duet maestro).
# Motherboard is named "3FD1X ENTINE T1 2018/10/22"
# Several pins on the motherboard dont have a soldered pinheader, it is jst 2.0

# To flash using klipper.. press firmware reset button under the rotary knob
# Powerreset and confirm that the USB port is detected as "usb-03eb_6124-if00" (flashmode , BossaC)
# Flash and then Powerreset the printer again.

# See docs/Config_Reference.md for a description of parameters.


[mcu]
baud: 115200 #i have trubble to connect using faster speeds( even original marlin fw uses speed 115200)
# Customized firmware build
# If building Custom firmware with  "Enable extra low-level configuration options" disable Chip serial and empty usb serial
serial: /dev/serial/by-id/usb-Klipper_sam4s8c-if00
# If you did not disable serial, you have to find your own serial
#serial: /dev/serial/by-id/usb-Klipper_sam4s8c_00313753314D43383139303432303331-if00

[stepper_x]
# A5984
step_pin: PA19
dir_pin: PC27
enable_pin: !PC15
microsteps:32
rotation_distance: 40
endstop_pin: ^PC17
position_endstop: -1.494
position_min: -1.494
position_max: 312
homing_speed: 25

[stepper_y]
# A5984
step_pin: PA6
dir_pin: !PC23
enable_pin: !PA5
microsteps:32
rotation_distance: 40
endstop_pin: ^PA0
position_endstop: -36.098
position_min: -36.098
position_max: 383
homing_speed: 25

[stepper_z]
# A5984
step_pin: PA18
dir_pin: !PC26
enable_pin: !PA17
microsteps: 32
rotation_distance: 0.81
endstop_pin: ^PC16
position_endstop: -4
position_min: -8
position_max: 314
homing_speed: 15

[safe_z_home]
home_xy_position:-1.494,-36.098
speed: 15
z_hop: 7 #rise abowe glass clamp

[extruder]
# Nozzle
nozzle_diameter: 0.400
filament_diameter: 1.750
# Flow
step_pin: PA2
dir_pin: PC10
enable_pin: !PC11
microsteps: 32
# esteps=188.79
rotation_distance: 16.924 #was 15
heater_pin: !PA20
# Temperatures
sensor_type: ATC Semitec 104GT-2
sensor_pin: PC29
pullup_resistor: 1000
inline_resistor: 100
min_temp: 0
max_temp: 275
min_extrude_temp: 180 #default 170
# Calibration
# PID calibration with std brass nozzle and target 230
control: pid
pid_Kp: 19.789
pid_Ki: 1.109
pid_Kd: 88.310

[heater_bed]
heater_pin: PA23
# Temperature
sensor_type: ATC Semitec 104GT-2
sensor_pin: PB0
pullup_resistor: 10000
inline_resistor: 100
min_temp: 0
max_temp: 110
# Calibration
# PID calibration with 10mm bed insulation and target of 60
control: pid
pid_Kp: 69.036
pid_Ki: 1.202
pid_Kd: 991.533

[bed_screws]
screw1: 34,24
screw1_name: Front Left
screw2: 34,276
screw2_name: Front Right
screw3: 266,24
screw3_name: Back Left
screw4: 266,276
screw4_name: Back Right
screw5: 155,165
screw5_name: Center

[menu __main __setup __calib __bedlevel]
type: command
enable: {(not printer.idle_timeout.state == "Printing") }
name: Manual Bed Leveling
gcode: BED_SCREWS_ADJUST

[heater_fan hotend_fan]
pin: PC13  # FAN1
heater_temp: 50 #default 50
shutdown_speed: 1 #Set fan to 100% after emergency stop

[temperature_sensor MB-CPU]
sensor_type: temperature_mcu
sensor_mcu: mcu

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 3000
max_z_velocity: 5
max_z_accel: 100

[display]
lcd_type: st7920
cs_pin: PC28   # D/I or RS is chip select in serial mode
sclk_pin: PA22 # E = SCK in serial mode
sid_pin: PC8   # R/W is data in serial mode
# Rotary Knob (switch order to change upp/down)
encoder_pins: ^PA21,^PC12
encoder_steps_per_detent: 2 #default 4
click_pin: ^!PB3
# This is Firmware Erase/Flash Enable button
#Erase_pin: ^!PB12

[output_pin beeper]
pin: PA16
pwm: True
value: 0
shutdown_value:0
cycle_time: 0.001
scale: 1000

[static_digital_output my_output_pins]
pins: PC18, PC20, !PC22, !PB4  # MS1 & MS2 & MS3 on A5984 (force 32 microsteps), and CS1 on display

#[fan]
#pin: PC31  # FAN2 (part cooler)

#[Probe]
#pin1: PA24 #Calibration_1
#pin2: GND  #Calibration_2
#pin3: VCC  #Calibration_3

#[filament_switch_sensor RunoutSensor]
#pause_on_runout: True
#runout_gcode:
#  M600
#  M117 No Filament detected
#insert_gcode:
#  M117 Filament detected
#switch_pin: PA1 #SENSOR_E1_1
#switch_pin: PC14 #SENSOR_E1_2
#switch_pin: GND #SENSOR_E1_3
#switch_pin: VCC #SENSOR_E1_4

#[LED]
#LED_1: PB14
#LED_2: GND
#LED_3: 24V?

#[bltouch]
#Debug_1: PA10
#Debug_2: VCC
#Debug_3: GND
#Debug_4: PA9

#[Burning]
#Burning_1: VDDIO
#Burning_2: TMS/SWDIO/PB5
#Burning_3: GND
#Burning_4: TDO/TRACESWO/PB5
#Burning_5: TCK/SWCLK/PB7
#Burning_6: NRST
